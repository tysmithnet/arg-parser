<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Flavors.Test\GitFlavor_Should.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using FluentAssertions;
using Xunit;

namespace ArgParser.Flavors.Test
{
    public class GitOptions
    {
        public bool IsHelpRequested { get; set; }
        public bool IsVersionRequested { get; set; }
        public List&lt;string&gt; CurrentWorkingPaths { get; set; } = new List&lt;string&gt;();
    }

    public class CommitOptions : GitOptions
    {
        public bool IsAddAll { get; set; }
        public string Message { get; set; }
        public string[] Files { get; set; }
        public string ReuseMessageCommit { get; set; }
    }

    public class GitFlavor_Should
    {
        [Fact]
        public void Parse_Boolean_Switches_In_A_Hierarchy()
        {
            // arrange
            var git = new GitFlavor();
            git.AddBooleanSwitch(&#39;h&#39;, &quot;help&quot;, o =&gt;
            {
                if (o is GitOptions go)
                {
                    go.IsHelpRequested = true;
                }
            });
            
            var commit = new GitFlavor();
            git.AddBooleanSwitch(&#39;a&#39;, &quot;all&quot;, o =&gt;
            {
                if (o is CommitOptions co)
                {
                    co.IsAddAll = true;
                }
            });

            git.AddSubCommand(&quot;commit&quot;, commit);
            git.AddFactoryMethods(() =&gt; new GitOptions(), () =&gt; new CommitOptions());

            // act
            var result = git.Parse(&quot;commit -a -h&quot;.Split(&#39; &#39;));

            // assert
            int optionsParsedCount = 0;
            int commitParsedCount = 0;
            result.When&lt;GitOptions&gt;(options =&gt;
            {
                optionsParsedCount++;
                options.IsHelpRequested.Should().BeTrue();
            });
            result.When&lt;CommitOptions&gt;(options =&gt;
            {
                commitParsedCount++;
                options.IsAddAll.Should().BeTrue();
            });
            optionsParsedCount.Should().Be(1);
            commitParsedCount.Should().Be(1);
        }

        [Fact]
        public void Parse_Switches_In_A_Hierarchy()
        {
            // arrange
            var git = new GitFlavor();
            git.AddSingleValueSwitch(&#39;C&#39;, null, (o, s) =&gt;
            {
                if(o is GitOptions casted)
                    casted.CurrentWorkingPaths.Add(s);
            });

            var commit = new GitFlavor();
            commit.AddSingleValueSwitch(&#39;m&#39;, &quot;message&quot;, (o, s) =&gt;
            {
                if (o is CommitOptions casted)
                    casted.Message = s;
            });

            git.AddSubCommand(&quot;commit&quot;, commit);
            git.AddFactoryMethods(() =&gt; new GitOptions(), () =&gt; new CommitOptions());

            // act
            var result = git.Parse(&quot;commit -C path1 -C path2 -m something&quot;.Split(&#39; &#39;));

            // assert
            int optionsParsedCount = 0;
            int commitParsedCount = 0;
            result.When&lt;GitOptions&gt;(options =&gt;
            {
                optionsParsedCount++;
            });
            result.When&lt;CommitOptions&gt;(options =&gt;
            {
                commitParsedCount++;
                options.CurrentWorkingPaths.Should().BeEquivalentTo(new[] { &quot;path1&quot;, &quot;path2&quot; });
                options.Message.Should().Be(&quot;something&quot;);
            });
            optionsParsedCount.Should().Be(1);
            commitParsedCount.Should().Be(1);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,65,16,83,1],[31,9,31,10,1],[33,13,33,39,1],[34,13,35,13,1],[35,13,35,14,1],[35,14,36,17,1],[36,17,36,40,1],[36,40,37,17,1],[37,17,37,18,1],[37,18,38,21,1],[38,21,38,47,1],[38,47,39,17,1],[39,17,39,18,1],[39,18,40,13,1],[40,13,40,14,1],[40,14,40,16,1],[34,13,40,16,1],[42,13,42,42,1],[43,13,44,13,1],[44,13,44,14,1],[44,14,45,17,1],[45,17,45,43,1],[45,43,46,17,1],[46,17,46,18,1],[46,18,47,21,1],[47,21,47,40,1],[47,40,48,17,1],[48,17,48,18,1],[48,18,49,13,1],[49,13,49,14,1],[49,14,49,16,1],[43,13,49,16,1],[51,13,51,49,1],[52,13,52,41,1],[52,41,52,57,1],[52,57,52,65,1],[52,65,52,84,1],[52,84,52,86,1],[52,13,52,86,1],[55,13,55,63,1],[58,13,58,40,1],[59,13,59,39,1],[60,13,61,13,1],[61,13,61,14,1],[61,14,62,17,1],[62,17,62,38,1],[62,38,63,17,1],[63,17,63,59,1],[63,59,64,13,1],[64,13,64,14,1],[64,14,64,16,1],[60,13,64,16,1],[65,13,66,13,1],[66,13,66,14,1],[66,14,67,17,1],[67,17,67,37,1],[67,37,68,17,1],[68,17,68,52,1],[68,52,69,13,1],[69,13,69,14,1],[69,14,69,16,1],[65,13,69,16,1],[70,13,70,47,1],[71,13,71,46,1],[72,9,72,10,1],[76,9,76,10,1],[78,13,78,39,1],[79,13,80,13,1],[80,13,80,14,1],[80,14,81,17,1],[81,17,81,43,1],[81,43,82,21,1],[82,21,82,55,1],[82,55,83,13,1],[83,13,83,14,1],[83,14,83,16,1],[79,13,83,16,1],[85,13,85,42,1],[86,13,87,13,1],[87,13,87,14,1],[87,14,88,17,1],[88,17,88,47,1],[88,47,89,21,1],[89,21,89,40,1],[89,40,90,13,1],[90,13,90,14,1],[90,14,90,16,1],[86,13,90,16,1],[92,13,92,49,1],[93,13,93,41,1],[93,41,93,57,1],[93,57,93,65,1],[93,65,93,84,1],[93,84,93,86,1],[93,13,93,86,1],[96,13,96,88,1],[99,13,99,40,1],[100,13,100,39,1],[101,13,102,13,1],[102,13,102,14,1],[102,14,103,17,1],[103,17,103,38,1],[103,38,104,13,1],[104,13,104,14,1],[104,14,104,16,1],[101,13,104,16,1],[105,13,106,13,1],[106,13,106,14,1],[106,14,107,17,1],[107,17,107,37,1],[107,37,108,17,1],[108,17,108,97,1],[108,97,109,17,1],[109,17,109,58,1],[109,58,110,13,1],[110,13,110,14,1],[110,14,110,16,1],[105,13,110,16,1],[111,13,111,47,1],[112,13,112,46,1],[113,9,113,10,1]]);
    </script>
  </body>
</html>