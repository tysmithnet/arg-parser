<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Styles.Alba\ContextBuilderExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using ArgParser.Core;
using HelpRequestCallback =
    System.Func&lt;System.Collections.Generic.Dictionary&lt;object, ArgParser.Core.Parser&gt;,
        System.Collections.Generic.IEnumerable&lt;ArgParser.Core.ParseException&gt;, string&gt;;

namespace ArgParser.Styles.Alba
{
    public static class ContextBuilderExtensions
    {
        internal static readonly Dictionary&lt;IContext, AlbaContext&gt; AlbaContexts =
            new Dictionary&lt;IContext, AlbaContext&gt;();

        internal static readonly Dictionary&lt;Parser, Theme&gt; ParserThemes = new Dictionary&lt;Parser, Theme&gt;();

        public static ContextBuilder AddAutoHelp(this ContextBuilder builder, HelpRequestCallback callback,
            Func&lt;HelpRequestedParseResultFactory, HelpRequestedParseResultFactory&gt; setupCallback = null)
        {
            builder.ParseStrategyCreated += (sender, args) =&gt;
            {
                var albaContext = builder.Context.ToAlbaContext();
                ParserThemes.ToList().ForEach(kvp =&gt; albaContext.ThemeRepository.SetTheme(kvp.Key.Id, kvp.Value));
                args.ParseStrategy.Context = albaContext;
                var factory = new HelpRequestedParseResultFactory(args.ParseStrategy.ParseResultFactory, callback,
                    builder.Context);
                if (setupCallback != null)
                    factory = setupCallback(factory);
                args.ParseStrategy.ParseResultFactory =
                    factory;
            };
            return builder;
        }

        public static ContextBuilder RegisterAlba(this ContextBuilder builder)
        {
            AlbaContexts.Add(builder.Context, new AlbaContext(builder.Context));
            return builder;
        }

        public static ContextBuilder SetTheme(this ContextBuilder builder, string parserId, Theme theme)
        {
            var parser = builder.Context.ParserRepository.Get(parserId);
            if (!ParserThemes.ContainsKey(parser))
                ParserThemes.Add(parser, theme);
            ParserThemes[parser] = theme;
            return builder;
        }

        public static AlbaContext ToAlbaContext(this IContext context) =&gt; AlbaContexts[context];

        public static ParserBuilder WithTheme(this ParserBuilder builder, Theme theme)
        {
            if (!ParserThemes.ContainsKey(builder.Parser))
                ParserThemes.Add(builder.Parser, theme);
            ParserThemes[builder.Parser] = theme;
            return builder;
        }

        public static ParserBuilder&lt;T&gt; WithTheme&lt;T&gt;(this ParserBuilder&lt;T&gt; builder, Theme theme)
        {
            if (!ParserThemes.ContainsKey(builder.Parser))
                ParserThemes.Add(builder.Parser, theme);
            ParserThemes[builder.Parser] = theme;
            return builder;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,14,53,1],[16,9,16,107,1],[20,9,20,10,1],[21,13,22,13,1],[22,13,22,14,1],[22,14,23,17,1],[23,17,23,67,1],[23,67,24,17,1],[24,17,24,54,1],[24,54,24,113,1],[24,113,24,115,1],[24,17,24,115,1],[24,115,25,17,1],[25,17,25,58,1],[25,58,26,17,1],[26,17,27,38,1],[27,38,28,17,1],[28,17,28,43,1],[28,43,29,21,1],[29,21,29,54,1],[29,54,30,17,1],[30,17,31,29,1],[31,29,32,13,1],[32,13,32,14,1],[32,14,32,15,1],[21,13,32,15,1],[33,13,33,28,1],[34,9,34,10,1],[37,9,37,10,1],[38,13,38,81,1],[39,13,39,28,1],[40,9,40,10,1],[43,9,43,10,1],[44,13,44,73,1],[45,13,45,51,1],[46,17,46,49,1],[47,13,47,42,1],[48,13,48,28,1],[49,9,49,10,1],[51,75,51,96,1],[54,9,54,10,1],[55,13,55,59,1],[56,17,56,57,1],[57,13,57,50,1],[58,13,58,28,1],[59,9,59,10,1],[62,9,62,10,1],[63,13,63,59,1],[64,17,64,57,1],[65,13,65,50,1],[66,13,66,28,1],[67,9,67,10,1]]);
    </script>
  </body>
</html>