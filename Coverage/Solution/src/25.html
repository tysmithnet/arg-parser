<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Flavors\Git\GitFlavor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using ArgParser.Core;

namespace ArgParser.Flavors.Git
{
    [DebuggerDisplay(&quot;{Name}&quot;)]
    public class GitFlavor
    {
            
        public GitFlavor()
        {
            Parser = new GitParser(this);
        }

        public void Accept(IGitFlavorVisitor visitor)
        {
            visitor.Visit(this);
        }

        public void AddBooleanSwitch(char letter, string word, Action&lt;object&gt; consume, bool required = false)
        {
            var booleanSwitch = new BooleanSwitch
            {
                Letter = letter,
                Word = word,
                ConsumeCallback = consume
            };
            Switches.Add(booleanSwitch);
            Parser.AddParameter(booleanSwitch);
            RequiredParameters.Add(booleanSwitch);
        }

        public void AddFactoryMethods(params Func&lt;object&gt;[] methods)
        {
            FactoryFunctions.AddRange(methods);
        }

        public void AddPositional(Action&lt;object, string&gt; consume, bool required = false)
        {
            var positional = new Positional
            {
                ConsumeCallback = (o, strings) =&gt; consume(o, strings.First()),
                Max = 1,
                Min = 1
            };
            Positionals.Add(positional);
            Parser.AddParameter(positional);
            if (required)
                RequiredParameters.Add(positional);
        }

        public void AddPositionals(Action&lt;object, string[]&gt; consume, int min = 1, int max = int.MaxValue)
        {
            var positional = new Positional
            {
                ConsumeCallback = consume,
                Max = max,
                Min = min
            };
            Positionals.Add(positional);
            Parser.AddParameter(positional);
        }

        public void AddSingleValueSwitch(char letter, string word, Action&lt;object, string&gt; consume)
        {
            var singleValueSwitch = new SingleValueSwitch
            {
                ConsumeCallback = consume,
                Letter = letter,
                Word = word
            };
            Switches.Add(singleValueSwitch);
            Parser.AddParameter(singleValueSwitch);
        }

        public void AddSubCommand(string command, GitFlavor flavor)
        {
            flavor.BaseFlavor = this;
            flavor.Depth = Depth + 1;
            SubCommands.Add(command, flavor);
        }

        public void AddValueSwitch(char letter, string word, Action&lt;object, string[]&gt; consume)
        {
            var valuesSwitch = new ValuesSwitch
            {
                Letter = letter,
                Word = word,
                ConsumeCallback = consume
            };
            Switches.Add(valuesSwitch);
            Parser.AddParameter(valuesSwitch);
        }

        public IParseResult Parse(string[] args, IEnumerable&lt;Func&lt;object&gt;&gt; factoryFunctions = null)
        {
            var possibleSubCommand = args[0];
            if (SubCommands.ContainsKey(possibleSubCommand))
            {
                var subCommandFlavor = SubCommands[possibleSubCommand];
                return subCommandFlavor.Parse(args.Skip(1).ToArray(), factoryFunctions ?? FactoryFunctions);
            }

            var strat = new GitParseStrategy(factoryFunctions ?? FactoryFunctions);
            if (RequiredParameters.Any())
            {
                var validators = RequiredParameters.Select(parameter =&gt; new RequiredParameterValidator(parameter));
                foreach (var requiredParameterValidator in validators) strat.Validators.Add(requiredParameterValidator);
            }

            var visitor = new AncestorAndDescendentVisitor();
            Accept(visitor);
            return strat.Parse(visitor.GitFlavors.Select(x =&gt; x.Parser), args);
        }

        public GitFlavor BaseFlavor { get; set; }

        public int Depth { get; set; }
        public List&lt;Func&lt;object&gt;&gt; FactoryFunctions { get; set; } = new List&lt;Func&lt;object&gt;&gt;();
        public string Name { get; set; }
        public GitParser Parser { get; set; }
        public List&lt;Positional&gt; Positionals { get; set; } = new List&lt;Positional&gt;();

        public IList&lt;GitParameter&gt; RequiredParameters { get; set; } = new List&lt;GitParameter&gt;();
        public Dictionary&lt;string, GitFlavor&gt; SubCommands { get; set; } = new Dictionary&lt;string, GitFlavor&gt;();
        public List&lt;Switch&gt; Switches { get; set; } = new List&lt;Switch&gt;();
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,27,1],[14,9,14,10,1],[15,13,15,42,1],[16,9,16,10,1],[19,9,19,10,1],[20,13,20,33,1],[21,9,21,10,1],[24,9,24,10,1],[25,13,30,15,1],[31,13,31,41,1],[32,13,32,48,1],[33,13,33,51,1],[34,9,34,10,1],[37,9,37,10,1],[38,13,38,48,1],[39,9,39,10,1],[42,9,42,10,1],[43,13,45,51,1],[45,51,45,78,1],[45,78,48,15,1],[43,13,48,15,1],[49,13,49,41,1],[50,13,50,45,1],[51,13,51,26,1],[52,17,52,52,1],[53,9,53,10,1],[56,9,56,10,1],[57,13,62,15,1],[63,13,63,41,1],[64,13,64,45,1],[65,9,65,10,1],[68,9,68,10,1],[69,13,74,15,1],[75,13,75,45,1],[76,13,76,52,1],[77,9,77,10,1],[80,9,80,10,1],[81,13,81,38,1],[82,13,82,38,1],[83,13,83,46,1],[84,9,84,10,1],[87,9,87,10,1],[88,13,93,15,1],[94,13,94,40,1],[95,13,95,47,1],[96,9,96,10,1],[99,9,99,10,1],[100,13,100,46,1],[101,13,101,61,1],[102,13,102,14,1],[103,17,103,72,1],[104,17,104,109,1],[107,13,107,84,1],[108,13,108,42,1],[109,13,109,14,1],[110,17,110,73,1],[110,73,110,114,1],[110,114,110,116,1],[110,17,110,116,1],[111,17,111,24,1],[111,26,111,56,1],[111,57,111,59,1],[111,60,111,70,1],[111,72,111,121,1],[112,13,112,14,1],[114,13,114,62,1],[115,13,115,29,1],[116,13,116,63,1],[116,63,116,71,1],[116,71,116,80,1],[116,13,116,80,1],[117,9,117,10,1],[122,68,122,92,1],[125,61,125,83,1],[127,71,127,95,1],[128,74,128,109,1],[129,54,129,72,1]]);
    </script>
  </body>
</html>