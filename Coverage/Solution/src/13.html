<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Styles\ContextBuilder.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using ArgParser.Core;

namespace ArgParser.Styles
{
    public class ContextBuilder
    {
        public ContextBuilder(string rootParserId)
        {
            RootParserId = rootParserId.ThrowIfArgumentNull(nameof(rootParserId));
            Context = new Context
            {
                HierarchyRepository = HierarchyRepository,
                ParserRepository = ParserRepository
            };
        }

        public event EventHandler&lt;ParseStrategyCreatedEventArgs&gt; ParseStrategyCreated;

        public ParserBuilder AddParser(string id, Action&lt;ParserHelpBuilder&gt; helpSetupCallback = null)
        {
            var parser = ParserRepository.Create(id);
            HierarchyRepository.AddParser(id);
            if (helpSetupCallback != null)
            {
                var builder = new ParserHelpBuilder(parser);
                helpSetupCallback(builder);
                parser.Help = builder.Build();
            }

            return new ParserBuilder(this, parser);
        }

        public ParserBuilder&lt;T&gt; AddParser&lt;T&gt;(string id, Action&lt;ParserHelpBuilder&gt; helpSetupCallback = null)
        {
            var parser = ParserRepository.Create&lt;T&gt;(id);
            HierarchyRepository.AddParser(id);

            if (helpSetupCallback != null)
            {
                var builder = new ParserHelpBuilder(parser);
                helpSetupCallback(builder);
                parser.Help = builder.Build();
            }

            return new ParserBuilder&lt;T&gt;(this, parser);
        }

        public ContextBuilder CreateParentChildRelationship(string parent, string child)
        {
            HierarchyRepository.EstablishParentChildRelationship(parent, child);
            return this;
        }

        public IParseResult Parse(string[] args)
        {
            var context = Context;
            var strat = new ParseStrategy.ParseStrategy(context, RootParserId);
            OnParseStrategyCreated(strat);
            return strat.Parse(args, context);
        }

        protected virtual void OnParseStrategyCreated(ParseStrategy.ParseStrategy parseStrategy)
        {
            ParseStrategyCreated?.Invoke(this, new ParseStrategyCreatedEventArgs
            {
                ParseStrategy = parseStrategy.ThrowIfArgumentNull(nameof(parseStrategy))
            });
        }

        public Context Context { get; protected internal set; }
        protected internal HierarchyRepository HierarchyRepository { get; set; } = new HierarchyRepository();
        protected internal ParserRepository ParserRepository { get; set; } = new ParserRepository();
        protected internal string RootParserId { get; set; }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[8,9,8,51,1],[9,9,9,10,1],[10,13,10,83,1],[11,13,15,15,1],[16,9,16,10,1],[21,9,21,10,1],[22,13,22,54,1],[23,13,23,47,1],[24,13,24,43,1],[25,13,25,14,1],[26,17,26,61,1],[27,17,27,44,1],[28,17,28,47,1],[29,13,29,14,1],[31,13,31,52,1],[32,9,32,10,1],[35,9,35,10,1],[36,13,36,57,1],[37,13,37,47,1],[39,13,39,43,1],[40,13,40,14,1],[41,17,41,61,1],[42,17,42,44,1],[43,17,43,47,1],[44,13,44,14,1],[46,13,46,55,1],[47,9,47,10,1],[50,9,50,10,1],[51,13,51,81,1],[52,13,52,25,1],[53,9,53,10,1],[56,9,56,10,1],[57,13,57,35,1],[58,13,58,80,1],[59,13,59,43,1],[60,13,60,47,1],[61,9,61,10,1],[64,9,64,10,1],[65,13,68,16,1],[69,9,69,10,1],[72,84,72,109,1],[73,78,73,100,1]]);
    </script>
  </body>
</html>