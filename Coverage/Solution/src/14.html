<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Styles\HierarchyRepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using ArgParser.Core;

namespace ArgParser.Styles
{
    public class HierarchyRepository : IHierarchyRepository
    {
        public void AddParser(string parserId)
        {
            if (Nodes.ContainsKey(parserId))
                return;
            Nodes.Add(parserId, new Node(parserId));
        }

        public void EstablishParentChildRelationship(string parentParserId, string childParserId)
        {
            parentParserId.ThrowIfArgumentNull(nameof(parentParserId));
            childParserId.ThrowIfArgumentNull(nameof(childParserId));
            if (!Nodes.ContainsKey(parentParserId))
                throw new KeyNotFoundException(
                    $&quot;Unable to find parent parser with id={parentParserId}, are you sure it was added and you are using the correct id?&quot;);
            if (!Nodes.ContainsKey(childParserId))
                throw new KeyNotFoundException(
                    $&quot;Unable to find child parser with id={childParserId}, are you sure it was added and you are using the correct id?&quot;);
            var parent = Nodes[parentParserId];
            if (parent.Children.All(x =&gt; x.Id != childParserId))
                parent.Add(Nodes[childParserId]);
        }

        public IEnumerable&lt;string&gt; GetAncestors(string parserId)
        {
            parserId.ThrowIfArgumentNull(nameof(parserId));
            if (!Nodes.ContainsKey(parserId))
                throw new KeyNotFoundException(
                    $&quot;Unable to find parser with id={parserId}, are you sure it was added and you are using the correct id?&quot;);
            var results = new List&lt;string&gt;();
            var itr = Nodes[parserId];
            while (itr.Parent != null)
            {
                results.Add(itr.Parent.Id);
                itr = itr.Parent;
            }

            return results;
        }

        public IEnumerable&lt;string&gt; GetChildren(string parserId)
        {
            if (!Nodes.ContainsKey(parserId))
                throw new KeyNotFoundException(
                    $&quot;Unable to find parent parser with id={parserId}, are you sure it was added and you are using the correct id?&quot;);
            return Nodes[parserId].Children.Select(x =&gt; x.Id);
        }

        public string GetRoot()
        {
            var allChildren = Nodes.SelectMany(pair =&gt; pair.Value.Children);
            var root = Nodes.Values.Except(allChildren).Single();
            return root.Id;
        }

        public bool IsParent(string parentParserId, string childParserId)
        {
            if (childParserId == null)
                return false;
            if (!Nodes.ContainsKey(childParserId))
                return false;
            return Nodes[childParserId].Parent?.Id == parentParserId;
        }

        protected internal Dictionary&lt;string, Node&gt; Nodes { get; set; } = new Dictionary&lt;string, Node&gt;();

        protected internal class Node
        {
            public Node(string id)
            {
                Id = id.ThrowIfArgumentNull(nameof(id));
            }

            public void Add(Node child)
            {
                Children.Add(child);
                child.Parent = this;
            }

            public IList&lt;Node&gt; Children { get; set; } = new List&lt;Node&gt;();
            public string Id { get; set; }
            public Node Parent { get; set; }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[10,9,10,10,1],[11,13,11,45,1],[12,17,12,24,1],[13,13,13,53,1],[14,9,14,10,1],[17,9,17,10,1],[18,13,18,72,1],[19,13,19,70,1],[20,13,20,52,1],[21,17,22,140,1],[23,13,23,51,1],[24,17,25,138,1],[26,13,26,48,1],[27,13,27,42,1],[27,42,27,63,1],[27,63,27,65,1],[27,13,27,65,1],[28,17,28,50,1],[29,9,29,10,1],[32,9,32,10,1],[33,13,33,60,1],[34,13,34,46,1],[35,17,36,127,1],[37,13,37,46,1],[38,13,38,39,1],[39,13,39,39,1],[40,13,40,14,1],[41,17,41,44,1],[42,17,42,34,1],[43,13,43,14,1],[45,13,45,28,1],[46,9,46,10,1],[49,9,49,10,1],[50,13,50,46,1],[51,17,52,134,1],[53,13,53,57,1],[53,57,53,61,1],[53,61,53,63,1],[53,13,53,63,1],[54,9,54,10,1],[57,9,57,10,1],[58,13,58,56,1],[58,56,58,75,1],[58,75,58,77,1],[58,13,58,77,1],[59,13,59,66,1],[60,13,60,28,1],[61,9,61,10,1],[64,9,64,10,1],[65,13,65,39,1],[66,17,66,30,1],[67,13,67,51,1],[68,17,68,30,1],[69,13,69,70,1],[70,9,70,10,1],[72,75,72,105,1],[76,13,76,35,1],[77,13,77,14,1],[78,17,78,57,1],[79,13,79,14,1],[82,13,82,14,1],[83,17,83,37,1],[84,17,84,37,1],[85,13,85,14,1],[87,57,87,73,1]]);
    </script>
  </body>
</html>