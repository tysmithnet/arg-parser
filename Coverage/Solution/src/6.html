<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\projects\arg-parser\ArgParser\ArgParser.Styles.Alba\ParserHelpTemplate.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.IO;
using System.Linq;
using Alba.CsConsoleFormat;
using Alba.CsConsoleFormat.ColorfulConsole;
using ArgParser.Core;

namespace ArgParser.Styles.Alba
{
    public class ParserHelpTemplate : ITemplate
    {
        public ParserHelpTemplate(IContext context, string parserId)
        {
            Context = context.ToAlbaContext();
            Parser = context.ParserRepository.Get(parserId);
            ViewModel = CreateViewModel(context);
        }

        public Document Create()
        {
            using (var fs = File.OpenRead(&quot;ParserHelp.xaml&quot;))
            {
                return ConsoleRenderer.ReadDocumentFromStream(fs, ViewModel, new XamlElementReaderSettings
                {
                    ReferenceAssemblies =
                    {
                        typeof(FigletDiv).Assembly,
                        typeof(ParserHelpTemplate).Assembly,
                        typeof(Parser).Assembly
                    }
                });
            }
        }

        private ParserHelpTemplateViewModel CreateViewModel(IContext context)
        {
            var albaContext = context.ToAlbaContext();
            var vm = new ParserHelpTemplateViewModel
            {
                Chain = albaContext.PathToRoot(Parser.Id).Reverse().Select(x =&gt; new ParserViewModel
                {
                    Parser = x,
                    Theme = albaContext.ThemeRepository.Get(x.Id)
                }).ToList()
            };
            vm.ParameterVms = vm.Chain.SelectMany(x =&gt; x.Parser.Parameters.Select(y =&gt; new ParameterViewModel
            {
                Parameter = y,
                Theme = x.Theme
            })).ToList();
            return vm;
        }

        protected internal AlbaContext Context { get; set; }
        protected internal Parser Parser { get; set; }
        protected internal ParserHelpTemplateViewModel ViewModel { get; set; }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,9,11,69,1],[12,9,12,10,1],[13,13,13,47,1],[14,13,14,61,1],[15,13,15,50,1],[16,9,16,10,1],[19,9,19,10,1],[20,20,20,61,1],[21,13,21,14,1],[22,17,30,20,1],[32,9,32,10,1],[35,9,35,10,1],[36,13,36,55,1],[37,13,39,81,1],[39,81,43,18,1],[43,18,44,15,1],[37,13,44,15,1],[45,13,45,56,1],[45,56,45,88,1],[45,88,49,14,1],[49,14,49,15,1],[45,56,49,15,1],[49,15,49,26,1],[45,13,49,26,1],[50,13,50,23,1],[51,9,51,10,1]]);
    </script>
  </body>
</html>